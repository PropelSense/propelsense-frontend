# Wave Data Validation & Quality Assurance

## Overview

PropelSense implements comprehensive wave data validation to ensure physically accurate and reliable marine weather intelligence. **This system features dual presentation modes**: Educational Mode (default) for demonstrations and Diagnostic Mode for technical analysis.

## Design Philosophy

> **"Rather than blindly displaying model output, this system detects when global wave models lose reliability in sheltered seas and adapts the presentation accordingly."**

This approach transforms technical limitations into teaching moments, demonstrating domain intelligence without overwhelming users or judges in educational competition settings.

## Dual-Mode Architecture

### Educational Mode (Default)

**Purpose**: Judge-friendly, demonstration-ready interface

**Behavior**:
- Minimal technical warnings
- Educational framing of limitations
- Greyed-out invalid data with explanatory text
- One-sentence insights instead of error lists
- Focus on "What is the sea like right now?"

**UI Elements**:
- üéì Badge: "Educational Mode"
- Info card: "Wave Model Awareness Active"
- Simplified language: "Limited reliability" not "Invalid data"
- Teaching tooltips: Why models struggle in Baltic Sea

### Diagnostic Mode (Optional)

**Purpose**: Full technical validation for reviewers and domain experts

**Behavior**:
- Complete validation warnings and errors
- Technical terminology and detailed explanations
- Color-coded quality indicators (red/orange/yellow)
- Per-system validation status
- Full data display regardless of quality

**UI Elements**:
- üìä Badge: "Diagnostic Mode"
- Error/Warning cards with bullet lists
- Quality badges: INVALID/LOW/MEDIUM/HIGH
- Technical explanations of failures

### Mode Toggle

Located in header:
```tsx
<Button onClick={() => setDiagnosticMode(!diagnosticMode)}>
  {diagnosticMode ? 'üìä Diagnostic' : 'üéì Educational'} Mode
</Button>
```

Users can switch modes to see different presentations of the same validation logic.

## Critical Validation Rules

### 1. Swell Classification Validation

**Rule**: Swell waves MUST have longer periods than wind waves

```typescript
// Minimum thresholds
const MIN_SWELL_PERIOD = 5.0s  // Open ocean
const MIN_SWELL_PERIOD_BALTIC = 6.0s  // Baltic Sea (fetch-limited)
const MIN_PRIMARY_SWELL_PERIOD = 8.0s  // Primary swell strict threshold
```

**Enforcement**:
- If `period < 5s` ‚Üí Classified as Wind Wave (ERROR)
- If `primary_swell_period < 8s` ‚Üí Warning issued
- Period = 0.0s or NaN ‚Üí Invalid data (ERROR)

**Rationale**: 
- Swell waves are long-period waves generated by distant wind systems
- Wind waves are short-period waves generated by local wind
- Misclassification indicates spectral partitioning error

### 2. Swell Hierarchy Validation

**Rule**: Primary swell MUST have the longest period

```typescript
if (secondary_swell_period > primary_swell_period) {
  ERROR: "Swell systems may be mislabeled"
}
```

**Enforcement**:
- `primary_swell_period >= secondary_swell_period` (REQUIRED)
- Hierarchy inversion ‚Üí Critical error flagged

**Rationale**:
- Primary swell represents the dominant wave system
- Secondary swell represents lesser energy systems
- Inverted hierarchy indicates upstream model error

### 3. Wind Wave & Swell Coexistence

**Rule**: Swell without wind waves is suspicious in semi-enclosed seas

```typescript
if (wind_wave_height < 0.01m && swell_height > 0) {
  if (isBalticSea && swell_period < 8s) {
    ERROR: "Swell without wind waves rare in Baltic Sea"
  }
}
```

**Enforcement**:
- Baltic Sea: Flag if wind wave = 0 and swell period < 8s
- Open ocean: Warning only for short-period swell
- Long-period swell (‚â•8s) without wind waves is acceptable

**Rationale**:
- Baltic is fetch-limited ‚Üí Local wind waves common
- Long-period swell can exist independently in open ocean
- Missing wind waves may indicate filtered spectrum

### 4. Invalid Wave Periods

**Rule**: Never render zero or NaN periods

```typescript
function validateWavePeriod(period: number): number | null {
  if (isNaN(period) || period === 0.0 || period < 2.0) {
    return null;  // Display "Period unavailable"
  }
  return period;
}
```

**Enforcement**:
- Period = 0.0s ‚Üí Display "Period unavailable"
- Period = NaN ‚Üí Display "Period unavailable"
- Period < 2.0s ‚Üí Considered invalid (capillary waves)

**Rationale**:
- Physical impossibility: Waves cannot have zero period
- NaNs indicate upstream model failure or empty spectral bins
- Sub-2s periods are not significant waves for vessel operations

## Regional Context

### Baltic Sea Specific Rules

```typescript
function isBalticSea(latitude: number, longitude: number): boolean {
  return latitude >= 53.5 && latitude <= 66 && longitude >= 10 && longitude <= 30;
}
```

**Special Considerations**:
- **Fetch-Limited**: Long-period swell is rare and weak
- **Swell Threshold**: Reduced to 6-7s (vs 8s for open ocean)
- **Wind Wave Dominance**: Local wind waves more common than swell
- **Confidence Reduction**: Lower confidence for long-period swell

**Validation Adjustments**:
- Lower minimum swell period (6s vs 5s)
- Flag swell without wind waves as critical error
- Reduce confidence scores for swell systems

## Cross-Sea Conditions

### Detection Algorithm

```typescript
function detectCrossSeaConditions(
  primaryDirection: number,
  secondaryDirection: number,
  primaryHeight: number,
  secondaryHeight: number
): CrossSeaResult | null {
  // Calculate angular difference
  let angleDiff = Math.abs(primaryDirection - secondaryDirection);
  if (angleDiff > 180) {
    angleDiff = 360 - angleDiff;
  }

  // Cross-sea threshold: > 30¬∞ difference
  if (angleDiff > 30 && primaryHeight >= 0.3m && secondaryHeight >= 0.2m) {
    return {
      isCrossSea: true,
      angle: angleDiff,
      severity: angleDiff > 60 ? "high" : angleDiff > 45 ? "moderate" : "low"
    };
  }
  return null;
}
```

**Alert Conditions**:
- Angular difference > 30¬∞ between wave systems
- Both systems have significant energy (primary ‚â• 0.3m, secondary ‚â• 0.2m)
- Severity increases with angle and wave height

**Maritime Impact**:
- Increased vessel roll and pitch
- Reduced stability even at low wave heights
- Difficult deck operations
- Enhanced fatigue on crew and structure

## Data Quality Indicators

### Quality Levels

| Level | Description | Trigger Conditions |
|-------|-------------|-------------------|
| **High** | Nominal conditions, reliable data | No warnings or errors |
| **Medium** | Minor issues, data usable with caution | 1-2 warnings, no errors |
| **Low** | Significant concerns, low confidence | 3+ warnings or low-energy conditions |
| **Invalid** | Critical errors, data unreliable | Any critical error detected |

### Confidence Factors

```typescript
function getDataConfidence(waveHeight: number, period: number, hasNaNs: boolean) {
  if (hasNaNs) return "low";                    // Missing data
  if (period < 4.0s) return "low";             // Below reliable threshold
  if (waveHeight < 0.2m) return "low";         // Model confidence threshold
  if (waveHeight < 0.5m) return "medium";      // Low energy
  return "high";                                // Nominal conditions
}
```

**Low Confidence Triggers**:
- Wave heights < 0.2m (model error zone)
- Wave periods < 4s (measurement uncertainty)
- NaNs encountered upstream
- Near-zero values (high relative error)

## UI Implementation

### Educational Mode Display

**Simplified Insight Card**:
```tsx
<Card className="border-cyan-500/30 bg-cyan-900/5">
  <CardContent>
    <div className="text-cyan-300">
      Wave Model Awareness Active (Sheltered Sea)
    </div>
    <p className="text-neutral-300">
      Rather than blindly displaying model output, this system detects when 
      global wave models lose reliability in sheltered seas and adapts the 
      presentation accordingly. Global wave models have limited reliability 
      in enclosed seas like the Baltic.
    </p>
    <button onClick={() => setDiagnosticMode(true)}>
      View technical diagnostic details ‚Üí
    </button>
  </CardContent>
</Card>
```

**Invalid Swell Cards** (Educational Mode):
- Greyed out with reduced opacity
- Display: "Educational reference only"
- Subtitle: "Not emphasized in this region"
- Maintains card structure but removes misleading data

**Educational Tooltip**:
```tsx
<Card className="border-cyan-700/30">
  <CardContent>
    üí° Why wave models struggle in the Baltic Sea
    ‚Ä¢ Fetch-limited basin
    ‚Ä¢ Short wave periods
    ‚Ä¢ Weak spectral separation
    ‚Ä¢ Designed for open ocean
    
    "This system recognizes these constraints and adjusts interpretation 
    accordingly - turning a limitation into a teaching moment."
  </CardContent>
</Card>
```

### Diagnostic Mode Display

**Full Validation Warnings**:

```tsx
{validation && (validation.overall.warnings.length > 0 || 
                validation.overall.errors.length > 0) && (
  <Card className="border-yellow-500/50 bg-yellow-900/10">
    <CardContent>
      <div className="font-medium">
        Data Quality: {validation.overall.quality.toUpperCase()}
      </div>
      
      {/* Critical Errors */}
      {validation.overall.errors.map(error => (
        <div className="text-red-300">‚Ä¢ {error}</div>
      ))}
      
      {/* Warnings */}
      {validation.overall.warnings.map(warning => (
        <div className="text-yellow-300">‚Ä¢ {warning}</div>
      ))}
    </CardContent>
  </Card>
)}
```

### Quality Badges

Each wave system displays its quality level:

```tsx
<Card className={`bg-zinc-900/90 ${
  validation?.primarySwell.quality === "invalid" ? "border-red-600/50" :
  validation?.primarySwell.quality === "low" ? "border-orange-600/50" :
  validation?.primarySwell.quality === "medium" ? "border-yellow-600/50" :
  "border-zinc-700"
}`}>
  <CardTitle>
    Primary Swell
    {validation?.primarySwell.quality !== "high" && (
      <span className="text-xs bg-yellow-500/20 text-yellow-400">
        {validation?.primarySwell.quality}
      </span>
    )}
  </CardTitle>
</Card>
```

### Cross-Sea Alert

Prominent orange alert when cross-sea conditions detected:

```tsx
{validation.crossSeaConditions && (
  <Card className="border-orange-500/50 bg-orange-900/10">
    <CardContent>
      ‚ö†Ô∏è Cross-Sea Conditions Detected
      <div>
        Wave systems from different directions ({validation.crossSeaAngle}¬∞ apart)
        increase vessel instability and motion. Exercise caution during operations.
      </div>
    </CardContent>
  </Card>
)}
```

## Guardrail Rules Summary

### Minimum Guardrails (TL;DR)

1. ‚úÖ **Never label swell with period < 5s** ‚Üí Reclassify as wind wave
2. ‚úÖ **Primary swell must have longest period** ‚Üí Flag hierarchy inversions
3. ‚úÖ **Do not show NaNs or 0.0s** ‚Üí Display "Period unavailable"
4. ‚úÖ **Suppress swell if wind wave = 0 and swell period < 8s** ‚Üí Flag as error in Baltic
5. ‚úÖ **Add Baltic-specific thresholds** ‚Üí Reduce swell period requirements
6. ‚úÖ **Flag cross-sea directions** ‚Üí Alert when |dir‚ÇÅ - dir‚ÇÇ| > 30¬∞
7. ‚úÖ **Show data confidence indicators** ‚Üí High/Medium/Low/Invalid badges
8. ‚úÖ **Better calm-state labeling** ‚Üí "Low-energy mixed wave field" vs "Calm"

## Integration with Propulsion Models

### Feature Engineering

Validated wave data improves ML model reliability:

```python
def extract_wave_features(marine_data, validation):
    features = {
        'wave_height': marine_data['wave_height'],
        'wave_period': marine_data['wave_period'],
        'swell_dominance': marine_data['swell_height'] / marine_data['total_height'],
        'cross_sea_penalty': 1.15 if validation['crossSeaConditions'] else 1.0,
        'data_quality_weight': quality_to_weight(validation['overall']['quality']),
    }
    return features
```

### Quality-Weighted Predictions

```python
def predict_with_confidence(features, validation):
    base_prediction = model.predict(features)
    
    # Reduce confidence for low-quality data
    quality_weights = {
        'high': 1.0,
        'medium': 0.8,
        'low': 0.5,
        'invalid': 0.0  # Do not use for predictions
    }
    
    confidence = quality_weights[validation['overall']['quality']]
    
    return {
        'prediction': base_prediction,
        'confidence': confidence,
        'use_for_training': validation['overall']['quality'] in ['high', 'medium']
    }
```

## Language Guidelines for Educational Mode

### ‚ùå Avoid (Too Technical)
- "Invalid data"
- "Incorrect classification"
- "Broken spectral partition"
- "API issue"
- "Model failure"

### ‚úÖ Use (Educational Framing)
- "Limited reliability in sheltered waters"
- "Model-aware interpretation applied"
- "Educational constraint"
- "Designed for open ocean conditions"
- "Adaptive presentation"

### Tone Principles
1. **Confidence, not defensiveness**: Present adaptations as features, not bugs
2. **Educational framing**: Every limitation is a teaching opportunity
3. **Domain intelligence**: Show understanding of oceanographic constraints
4. **Judge-friendly**: Accessible to non-experts while maintaining technical depth

## Competition Strategy

### For Judges (Educational Mode)
- Clean, professional interface
- Minimal technical jargon
- Clear educational value
- Demonstrates domain awareness
- "Smart system that knows its limits"

### For Technical Reviewers (Diagnostic Mode)
- Full validation details
- Oceanographic accuracy
- Standards compliance
- Engineering rigor
- "Sophisticated validation under the hood"

### Live Demo Script

1. **Start in Educational Mode** (default)
   - Show clean interface with model awareness badge
   - Point out educational tooltip
   - "The system knows Baltic Sea is fetch-limited"

2. **Toggle to Diagnostic Mode**
   - Reveal full technical validation
   - Show wave period thresholds, hierarchy checks
   - "Complete oceanographic validation running behind the scenes"

3. **Key Message**
   - "Rather than blindly trusting model output, we validate and adapt"
   - "Turns limitations into teaching moments"
   - "Domain intelligence without overwhelming users"

## Validation Logic (Unchanged)

**Important**: All validation rules remain active in both modes. Only the presentation changes.

## References

### Oceanographic Standards

- **WMO Sea State Code**: Classification of sea conditions
- **Douglas Sea Scale**: Wind wave vs swell dominance
- **Beaufort Scale**: Wind speed to wave height correlation
- **ITTC Seakeeping**: Vessel motion in waves

### Model Documentation

- [OpenMeteo Marine API](https://open-meteo.com/en/docs/marine-weather-api)
- [ECMWF Wave Model](https://www.ecmwf.int/en/forecasts/documentation-and-support/wave-models)
- [NOAA Wavewatch III](https://polar.ncep.noaa.gov/waves/wavewatch/)

---

**Version**: 1.0.0  
**Last Updated**: January 20, 2026  
**Maintainer**: PropelSense Team
